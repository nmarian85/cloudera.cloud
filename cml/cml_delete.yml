---
cml_delete:
  stage: manage
  before_script:
    - cdp ml delete-workspace --generate-cli-skeleton > skel.json
    - python3 cml/cml_json.py --action delete --cluster $CML_CLUSTER_NAME --env $ENV_NAME
    - cat ${CML_CLUSTER_NAME}.json
  script: cdp --debug ml delete-workspace --workspace-name $CML_CLUSTER_NAME --cli-input-json file://${CML_CLUSTER_NAME}.json
  artifacts:
    paths:
      - skel.json
      - ${CML_CLUSTER_NAME}.json
    expire_in: 30 days
    when: always
  rules:
    - if: $CI_PIPELINE_SOURCE != "schedule"
      when: manual
  # only:
  #   - main
