---
cml_provision:
  stage: cml_provision
  tags:
    - docker
  before_script:
    - cdp ml create-workspace --generate-cli-skeleton > skel.json
    - python3 cml/cml_json_provision.py
    - cat provision_cml_*.json
  script:
    - ls -1 provision_cml_*.json | xargs -I '{}' cdp --debug ml create-workspace --cli-input-json file://'{}'
  artifacts:
    paths:
      - skel.json
      - provision_cml_*.json
    expire_in: 30 days
    when: always
  when: manual
  # only:
  #   - main

cml_delete:
  stage: cml_delete
  tags:
    - docker
  before_script:
    - cdp ml delete-workspace --generate-cli-skeleton > skel.json
    - python3 cml/cml_json_delete.py
    - cat delete_cml_*.json
  script: ls -1 delete_cml_*.json | xargs -I '{}' cdp --debug ml delete-workspace --cli-input-json file://'{}'
  artifacts:
    paths:
      - skel.json
      - delete_cml_*.json
    expire_in: 30 days
    when: always
  when: manual
  # only:
  #   - main
